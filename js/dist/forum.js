(()=>{var r={n:o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return r.d(t,{a:t}),t},d:(o,t)=>{for(var a in t)r.o(t,a)&&!r.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:t[a]})},o:(r,o)=>Object.prototype.hasOwnProperty.call(r,o)};(()=>{"use strict";const o=flarum.core.compat["common/extend"],t=flarum.core.compat["forum/app"];var a=r.n(t);const e=flarum.core.compat["forum/components/DiscussionPage"];var s=r.n(e);const i=flarum.core.compat["forum/components/Post"];var n=r.n(i);const c=flarum.core.compat["forum/components/CommentPost"];var p=r.n(c);const l=flarum.core.compat["common/components/Button"];var u=r.n(l);const d=flarum.core.compat["forum/components/DiscussionComposer"];var f=r.n(d);const y=flarum.core.compat["forum/components/ReplyComposer"];var h=r.n(y);const k=flarum.core.compat["forum/utils/PostControls"];var P=r.n(k);a().initializers.add("zhihe-primary-posts",function(){(0,o.extend)(s().prototype,"sidebarItems",function(r){var o=this;if(this.discussion){var t=new URLSearchParams(window.location.search).get("filter")||"all";r.add("primaryFilter",u().component({className:"Button Button--block",icon:"primary"===t?"fas fa-bookmark":"far fa-bookmark",onclick:function(){var r="all"===t?"primary":"all";o.toggleFilter(r)}},"primary"===t?a().translator.trans("zhihe-primary-posts.forum.all_posts"):a().translator.trans("zhihe-primary-posts.forum.primary_only")),5)}}),(0,o.extend)(s().prototype,"oninit",function(){this.toggleFilter=function(r){var o=new URL(window.location);"all"===r?o.searchParams.delete("filter"):o.searchParams.set("filter",r),window.history.replaceState({},"",o.toString()),document.querySelectorAll(".PostStream-item").forEach(function(o){var t=!!o.querySelector(".PrimaryBadge");o.style.display="primary"===r?t?"block":"none":"block"}),m.redraw()}}),(0,o.extend)(s().prototype,"oncreate",function(){"primary"===new URLSearchParams(window.location.search).get("filter")&&this.toggleFilter("primary")}),(0,o.extend)(p().prototype,"headerItems",function(r){var o=this.attrs.post;o&&o.attribute("isPrimary")&&r.add("primaryBadge",m("span",{className:"PrimaryBadge",title:a().translator.trans("zhihe-primary-posts.forum.primary_post")},m("i",{className:"fas fa-bookmark"})),80)}),(0,o.extend)(P(),"userControls",function(r,o,t){var e=o.discussion(),s=a().session.user;s&&e&&s.id()===e.user().id()&&(o.attribute("isPrimary")?r.add("unmarkPrimary",u().component({icon:"far fa-bookmark",onclick:function(){t.unmarkAsPrimary()}},a().translator.trans("zhihe-primary-posts.forum.unmark_primary")),90):r.add("markPrimary",u().component({icon:"fas fa-bookmark",onclick:function(){t.markAsPrimary()}},a().translator.trans("zhihe-primary-posts.forum.mark_primary")),90))}),(0,o.extend)(n().prototype,"oninit",function(){var r=this;this.markAsPrimary=function(){var o=r.attrs.post;a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/posts/"+o.id()+"/mark-primary"}).then(function(){o.pushAttributes({isPrimary:!0}),m.redraw()}).catch(function(r){console.error("Failed to mark post as primary:",r)})},this.unmarkAsPrimary=function(){var o=r.attrs.post;a().request({method:"DELETE",url:a().forum.attribute("apiUrl")+"/posts/"+o.id()+"/unmark-primary"}).then(function(){o.pushAttributes({isPrimary:!1,primaryNumber:null}),m.redraw()}).catch(function(r){console.error("Failed to unmark post as primary:",r)})}}),(0,o.extend)(f().prototype,"headerItems",function(r){var o=this;void 0===this.composer.fields.isPrimary&&(this.composer.fields.isPrimary=!0),r.add("isPrimary",m("div",{className:"Form-group"},[m("label",{className:"checkbox"},[m("input",{type:"checkbox",checked:this.composer.fields.isPrimary||!1,onchange:function(r){o.composer.fields.isPrimary=r.target.checked}})," ",a().translator.trans("zhihe-primary-posts.forum.primary_checkbox")])]),10)}),(0,o.extend)(h().prototype,"headerItems",function(r){var o=this,t=this.composer.body.attrs.discussion,e=a().session.user;e&&t&&e.id()===t.user().id()&&r.add("isPrimary",m("div",{className:"Form-group"},[m("label",{className:"checkbox"},[m("input",{type:"checkbox",checked:this.composer.fields.isPrimary||!1,onchange:function(r){o.composer.fields.isPrimary=r.target.checked}})," ",a().translator.trans("zhihe-primary-posts.forum.primary_checkbox")])]),10)}),(0,o.extend)(f().prototype,"data",function(r){r.isPrimary=this.composer.fields.isPrimary||!1}),(0,o.extend)(h().prototype,"data",function(r){r.isPrimary=this.composer.fields.isPrimary||!1})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map